<?php if (isset($this->messages)) {?>
    <div class="alert alert-warning">
        <button type="button" class="close" data-dismiss="alert">&times;</button>
        <h4>Warning!</h4>
        <ul>
        <?php
        foreach ($this->messages as $element => $errors) {
            foreach ($errors as $messageID => $message) {
                $item = $this->form->get($element)->getLabel();
                echo "<li>$item: $message</li>\n";
            }
        }
        ?>
        </ul>
    </div>
<?php } elseif (isset($this->success)) {?>
    <div class="alert alert-success">
        <button type="button" class="close" data-dismiss="alert">&times;</button>
        <?php echo $this->success; ?>
    </div>
<?php }


$form->setAttributes(array(
    'class' => 'form-horizontal'
));
$form->prepare();

echo $this->form()->openTag($form);
foreach ($form as $element) :?>
    <div class="form-group">
        <?php 
            $type = $element->getAttribute('type');
            $name = $element->getAttribute('name'); 
            $label = $element->getLabel();
            if ($element->getOption('validation')) {
                $validation = ' validation-' . $element->getOption('validation');
            } else {
                $validation = '';
            }
            
        ?>
        <?php if ($type == 'hidden') { ?>
            <div class="hidden"><?php echo $this->formElement($element); ?></div>
        <?php } else if ($type == 'submit') { ?>
            <?php
                if ($element->getAttribute('value')) {
                    $value = $element->getAttribute('value');
                } elseif ($element->getAttribute('caption')) {
                    $value = $element->getAttribute('caption');
                } else {
                    $value = 'Submit';
                }
                $id = $element->getAttribute('id'); 
            ?>
                <div class="col-xs-offset-3 col-xs-10">
                    <input type="submit" class="btn btn-primary submit-btn" value="<?php echo $value; ?>" id="<?php echo $id; ?>" name="<?php echo $name; ?>">
                </div>
        <?php } else if ($label != '') { ?>
                <label class="control-label col-xs-3"><?php echo $label ?></label>
                <div class="col-xs-9">
                    <input class="form-control <?php echo $validation;?>" name="<?php echo $name ?>" type="<?php echo $type ?>"<?php
                        if ($element->getOption('required')) {
                            echo ' required="required"';
                        }

                        if ($element->getOption('pattern')) {
                            echo ' pattern="' . $element->getOption('pattern') . '"';
                        }
                    ?> />
                </div>
        <?php } ?> 
    </div>
<?php 
endforeach;
echo $this->form()->closeTag();
